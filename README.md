# Bosai Lvとは

![logo](https://user-images.githubusercontent.com/100994776/195891384-ba180de7-a36a-4ff9-8e98-447f9770980d.jpg)

### 「Bosai Lv」は、防災に関するタスクを達成すると、防災レベルが上がるサービスです。

<br />

# URL
https://app.bosailv.com

[こちら](https://app.bosailv.com/signup)のページにある【**ゲストログイン**】ボタンをクリックすると、ユーザー登録なしでログインできますので、試しにご利用ください。
※ゲストユーザーは1日だけご利用いただけます。

<br />

# 作成背景
### 「より多くの人が災害に備えるためのきっかけになるものを作りたい。」という想いで作成しました。
 - 私は現在、公務員として防災関係業務に従事しています。
 - 業務に携わる中で、最近は自然災害が多発しており、多くの人の「**災害へ備えれなければいけない**」という意識が高まっていると感じました。
 - しかし、災害への備えとして「**何をすればよいのかがいまいちよく分からないから何もしていない。**」という声をよく聞きました。
 - 自然災害はこれからも多発していくと予想されているため、**この問題を解決し、多くの人が災害に備えてほしい**と感じました。
 - これらを踏まえて、下記の理由によりメイン機能を選定し、「**より多くの人が災害に備えるためのきっかけになるもの**」を作成しました。

<br />

## メイン機能選定理由
### 防災タスク機能
 - 災害に備えるべきことを明確にすることで、何をすればよいか分からない方も、防災に取り掛かりやすくなると考えました。
 - そのため、「**災害への備えとして何をすればよいのか」を「防災タスク」としてタスク形式にする**ことで、チェックリストのような役割を果たし、**災害に備えるべきことを示すことができる**と考え、この機能を選定しました。

### レベルアップ機能
 - さらに、防災タスクにゲームの要素を加えることで、楽しく防災に取り組むことができるため、より多くの人が災害に備えるきっかけになると考えました。
 - そのため、**防災タスクを達成するとポイントを獲得でき、そのポイントに応じてレベルが上がる機能を実装することで、自身の防災知識・備えを「防災レベル」として見える化**しようと考えました。
 - そうすることで、**自身の防災レベルが上がる楽しさから、防災にゲーム感覚で取り組んでもらえる**のではないかと考え、この機能を選定しました。

<br />

# 工夫した点
## フロントエンド面
 - **完全SPA化**で作成しました。
 - UIフレームワークにVuetifyを使用し、**整ったUI**を意識しました。
 - VuetifyのGridシステムを利用し、**レスポンシブデザイン**を実装しました。
 - 初期ページを本アプリの紹介ページにすることや、ログイン後まずはユーザー設定画面に遷移するなど、利用者がスムーズかつ便利に使ってもらうための**導線**を意識しました。
 - Jestを利用して、初期表示の正常系テスト・異常系テスト・クリックイベントのテストを実装しました。
 - ESLint/Prettierを利用して、読みやすいコードを意識しました。

## バックエンド面
 - 防災タスク達成によるレベルアップ機能や、ユーザーの家族構成に応じて備蓄量を計算するなど、**応用が必要な機能を複数実装**しました。
 - ゲストログインで作成された**ゲストユーザーを1日後に削除するバッチ処理(Rakeタスク)を実装**し、ECS(Fargate)でタスク定義して毎日20時に定期実行するようにしました。
 - 防災SNSアカウントのフォローチェックリストなど、複数の似た防災タスク(TaskProfileテーブル)を実装する際に、**無駄なカラムが増えないように[ActiveFlag](https://github.com/kenn/active_flag)(Bit array)で実装**しました。
 - 各市町村のハザードマップデータや避難所データなど、**10万行以上ある大量の初期データをseedで投入**しました。
 - RSpecを利用して、正常系テスト・異常系テストを実装しました。

## インフラ面
 - Codepipeline + Codebuildを使用したCI/CDを実現しました。
 - CircleCIを利用して、自動テストを実現しました。
 - Rails6(nginx + puma) + Nuxt.js + Aurora MysqlをECS(Fargate)環境で動かしました。
 - **Terraformを利用して、Codepipelineの構築をコード化**しました。
 - **Terraformを利用して、ECS(Fargate)環境の構築をコード化**しました。
 - RuboCopを利用して、読みやすいコードを意識しました。

<br />

# 機能一覧

## ユーザーに関連する機能
 - 新規登録
 - ログイン
 - ゲストログイン(作成されたゲストユーザーを1日後に削除するRakeタスク(バッチ処理)を実装)
 - ログアウト
 - 登録情報の編集(名前、画像、プロフィール、メールアドレス、パスワード、在住都道府県、在住市町村)
 - ユーザーページの表示(マイ記事(ジャンルごとの執筆記事・おきにいり記事)、マイ避難所、防災タスク達成状況、防災レベル、気象情報(気象庁HP))
 - ユーザーの獲得ポイントランキング

## 管理者ユーザーに関連する機能
 - ユーザーへのお知らせ作成
 - ユーザーへのお知らせ一覧
 - ユーザーへのお知らせ削除
 - 記事のジャンル作成
 - 記事のジャンル一覧
 - 記事のジャンル編集
 - 防災タスク作成
 - 防災タスク一覧
 - 防災タスク編集
 - 記事検索・削除
 - ユーザー検索・削除

## 防災タスクに関連する機能
#### ハザードマップに関する機能
   - ハザードマップ検索(住所を登録している場合、自分の在住市町村で検索できる。)
   - ハザードマップ確認

#### 避難所に関する機能
   - 避難所検索(住所を登録している場合、自分の在住市町村で検索できる。)
   - 避難所詳細データ(名前、該当する災害、住所、避難所の種類)
   - マイ避難所登録

#### 防災SNSに関する機能
   - 防災SNS一覧(各Twitterリンク)
   - 防災SNSフォローチェックリスト(無駄なカラムが増えないように、[ActiveFlag](https://github.com/kenn/active_flag)(Bit array)で実装。)

#### おうち防災に関する機能
   - おうち防災チェックリスト(無駄なカラムが増えないように、[ActiveFlag](https://github.com/kenn/active_flag)(Bit array)で実装。)

#### 家族会議メモに関する機能
   - 家族会議の内容メモ作成
   - 家族会議の内容メモ編集
   - 家族会議の内容メモリセット

#### 緊急連絡先に関する機能
   - 緊急連絡先登録
   - 緊急連絡先削除

#### 防災備蓄品リスト作成
   - 家族情報の作成
   - 家族情報の削除
   - 家族情報をもとに、必要な備蓄品リストを計算して一覧表示
   - 必要な備蓄品チェックリスト(無駄なカラムが増えないように、[ActiveFlag](https://github.com/kenn/active_flag)(Bit array)で実装。)

## 災害時役立つ記事に関連する機能
 - 災害時役立つ記事の作成(サムネイル、タイトル、ジャンル、内容)
 - 災害時役立つ記事の一覧(新着順、お気に入り数順)
 - 災害時役立つ記事の検索(タイトル、内容、ジャンル)
 - 災害時役立つ記事の編集
 - 災害時役立つ記事のシェア(Twitter)
 - 災害時役立つ記事にコメント作成
 - 災害時役立つ記事にコメント削除
 - お気に入り
 - 通知作成(コメント、お気に入りされたとき)

<br />

# インフラ構成図
![インフラ図](https://user-images.githubusercontent.com/100994776/195884582-f76e9f4d-4996-45a9-a28d-79cc6462fc5c.png)

<br />

# ER図
![ER図](https://user-images.githubusercontent.com/100994776/197386560-37790e1e-4e4c-47b4-b563-0541d57f1cba.png)
<br />

# 使用技術

| フロントエンド
----|
| Nuxt.js 2.15.8(SPA)  |
| Vuetify | 
| axios(バックエンドとの非同期通信) |
| eslint/prettier(静的解析、フォーマッター) |
| Jest(自動テスト) | 

<br />

| バックエンド |
----|
| Ruby 3.0.0 |
| Rails 6.1.5 |
| RuboCop(静的解析、フォーマッター) |
| RSpec(自動テスト) |
| nginx(Webサーバー) |
| puma(APサーバー) |
| MySQL 8.0(データベース) |

<br />

| インフラ |
----|
| Docker/docker-compose |
| AWS（ECR,ECS,Fargate,VPC,S3,Route53,ALB,RDS,ACM,SSM,CloudWatch,CodeBuild） |
| Terraform(インフラのコード管理) |
| CircleCI |

<br />

# コミットメッセージのプレフィックス

|  prefix  | 内容 |
|----------|------|
| feat     |  新機能 |
| fix      |  バグの修正 |
| docs     |  ドキュメントの修正 |
| style    |  コード内容に影響を与えない変更 <br> 例. white-space, formatting, missing semi-colons |
| refactor |  リファクタリング<br> バグの修正も機能の追加も行わないコード変更 |
| perf     |  パーフォマンスを向上させるための変更 |
| test     |  テストの追加・修正 |
